function refresh(e,o){function n(){console.log("Connecting to notifications...");var e=new EventSource("/notifications");e.onmessage=function(e){a(JSON.parse(e.data))},e.onerror=function(e){console.log("... error on notifications",e)},e.onopen=function(){console.log("... notifications ok!")}}var t=e,a=function(e){e.walkIndex==t.walkIndex&&e.paused==t.paused||o(e,function(){t=e})},i=function(){console.log("Master lost..."),splashReconnect()};n();var r=function(){jQuery.ajax({method:"GET",url:"/state",success:function(e){a(e),setTimeout(r,2500)},error:i})};setTimeout(r,2500)}function refreshDisplay(e,o){var n=function(e){jQuery("main").html(e),o()},t=function(){o()};jQuery.ajax({method:"GET",url:window.location,headers:{Accept:"application/vnd.easycast.display+html"},success:n,error:t})}function refreshRemote(e,o){jQuery("main.remote > ul li.active").removeClass("active"),jQuery("main.remote > ul li.node-"+e.walkIndex).addClass("active");var n=jQuery("main.remote > ul li.active").offset(),t=window.innerHeight;jQuery("html, body").animate({scrollTop:n.top-t/3,scrollLeft:n.left}),e.paused?(jQuery("#scheduler_icon").addClass("fa-play"),jQuery("#scheduler_icon").removeClass("fa-pause")):(jQuery("#scheduler_icon").removeClass("fa-play"),jQuery("#scheduler_icon").addClass("fa-pause")),o()}function refreshDoors(e,o){jQuery("main.doors ul li.active").removeClass("active"),jQuery("main.doors ul li.node-"+e.doorIndex).addClass("active"),o()}function installGallery(e,o,n){function t(a){var i=jQuery("#"+e+" img");i.length>0&&(i[0].src=o[a],setTimeout(function(){t((a+1)%o.length)},n))}t(0)}function splashWait(e){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==this.readyState&&200==this.status?window.location=e:4==this.readyState&&setTimeout(function(){splashWait(e)},2500)},console.log("Trying to reach master at "+e),o.open("GET",e,!0),o.send()}function splashConnect(){function e(){window.location=window.location}const o=window.location.search,n=new URLSearchParams(o),t=decodeURIComponent(n.get("target")||"http://easycast/");setTimeout(e,15e3),setTimeout(function(){splashWait(t)},1500)}function splashReconnect(){jQuery("aside.splash").show(),splashWait(window.location)}jQuery(function(){function e(e){e.preventDefault(),e.stopPropagation();var o=t.find("ul li.active").offset(),n=window.innerHeight;t.css({left:0}),t.addClass("open"),t.animate({scrollTop:o.top-n/2,scrollLeft:o.left})}function o(e){e.preventDefault(),e.stopPropagation(),t.css({left:-350}),t.removeClass("open")}function n(){document.getElementById("menu")&&(t=jQuery("#menu"),jQuery(".open-menu-btn").click(e),jQuery(".close-menu-btn").click(o),jQuery("body").click(o))}var t=null;n()}),jQuery(function(){jQuery("#cogs-toggle").click(function(){jQuery("main.remote > ul.prev-next").hide(),jQuery("main.remote > ul.cogs").show()}),jQuery("#cogs-back").click(function(){jQuery("main.remote > ul.prev-next").show(),jQuery("main.remote > ul.cogs").hide()}),jQuery("main.remote > ul > li a").click(function(e){var o=jQuery(this).attr("href");if(o){jQuery(this).data("confirm")&&!confirm("Etes-vous s\xfbr.e?")||(e.preventDefault(),e.stopPropagation(),$.ajax({url:o,method:"POST",data:{}}))}return!1})}),jQuery(function(){jQuery("main.doors ul > li").click(function(e){var o=jQuery(jQuery(this).find("a")).attr("href");return o&&(e.preventDefault(),e.stopPropagation(),$.ajax({url:o,method:"POST",data:{}})),!1})}),jQuery(function(){function e(){window.location=window.location}0!=jQuery("body.error").length&&setTimeout(e,2500)});