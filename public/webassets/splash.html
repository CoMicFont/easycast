<html>
<head>
  <meta charset="utf-8">
  <title>Easycast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>aside.splash{background:white;color:#222;margin:0;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-size:16px;text-align:center;position:fixed;top:0;bottom:0;left:0;right:0;height:100%;display:none}aside.splash>div{display:flex;align-items:center;justify-content:center;height:100%}aside.splash>div>div{padding:5% 5% 20% 5%}aside.splash h1{font-size:2em}aside.splash .lds-ripple{display:inline-block;position:relative;width:80px;height:80px}aside.splash .lds-ripple div{position:absolute;border:4px solid #222;opacity:1;border-radius:50%;animation:lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite}aside.splash .lds-ripple div:nth-child(2){animation-delay:-0.5s}@keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:0}4.9%{top:36px;left:36px;width:0;height:0;opacity:0}5%{top:36px;left:36px;width:0;height:0;opacity:1}100%{top:0px;left:0px;width:72px;height:72px;opacity:0}}
</style>
  <style>aside.splash { display: block !important; }</style>
</head>
<body>
<aside class="splash">
  <div>
    <div>
      <h1>Easycast</h1>
      <h2>Diffusion multi-écran low-tech et open-source!</h2>
      <p>En recherche du maître de diffusion...</p>
      <div class="lds-ripple"><div></div><div></div></div>
    </div>
  </div>
</aside>

<script>function splashWait(targetUrl) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      window.location = targetUrl;
    } else if (this.readyState == 4) {
      setTimeout(function(){
        splashWait(targetUrl);
      }, 2500);
    }
  };
  console.log("Trying to reach master at " + targetUrl);
  xhttp.open("GET", targetUrl, true);
  xhttp.send();
}

function splashConnect() {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const targetUrl = decodeURIComponent(urlParams.get('target') || "http://easycast/");

  function refresh() {
    window.location = window.location;
  }
  setTimeout(refresh, 15000);

  setTimeout(function() {
    splashWait(targetUrl);
  }, 1500);
}

function splashReconnect() {
  jQuery('aside.splash').show();

  splashWait(window.location)
}
;
</script>
<script>splashConnect();</script>
</body>
</html>
